function create_VIM_INTERPRETER(n,e,t,o){function r(n){W.push(n)}function i(){W.length>0&&W.pop()}function u(){return X}function s(n){if(n!==U&&n!==Q)throw"Mode "+X+" is not supported!";X=n}function c(n){return Z[n]}function a(n,e){Z[n]=e}function d(){e.initializeEmptyText()}function f(n){P=n,J=[],K=!0}function p(n){var e=H[n];e&&V.for_each(e,function(n){"q"!==n&&E(n)})}function m(){K=!1,H[P]=J,P=void 0}function h(){e.setContent(D)}function M(n){j.anonymous=n}function g(){var n=j.anonymous;return!!n&&e.copy(n)}function C(n,e){I(en,n,e)}function l(n,e){I(tn,n,e)}function I(n,e,t){if(void 0!==n[e])throw"command registered already for key: "+e;n[e]=t}function s(n){n===U?_():n===Q&&v()}function _(){W=[],X=U,o.sendMessage("updated_mode",U)}function v(){e.removeAllWithAttribute("appendable"),X=Q,o.sendMessage("updated_mode",Q)}function y(){return X===Q}function R(){return X===U}function E(n){V.for_each(n,function(n){A(n),z(n)})}function x(n){A(n),z(n)}function A(n){"u"!==n&&(D=e.copyContent())}function k(n){return"."===n}function w(n){G&&rn.push(n)}function z(n){o.sendMessage("interpret_code",n),e.updatePreviousCursor(),K&&J.push(n),Y.length>0?(w(n),t.show_help(),L(n)):y()?(k(n)||w(n),b(n),0===nn.length&&T()):q(n),o.sendMessage("interpreter_interpreted",n)}function T(){G&&(rn.length>0&&(on=rn),rn=[])}function b(n){var e=en[n];void 0!==e&&e()}function q(n){var e=tn[n];void 0!==e?e():B(n)&&(r(n),S(n))}function S(n){e.insertCharBefore(n,e.cursor())}function B(n){return!V.existsIn(n,["Esc","Backspace"])&&(n>="0"&&n<="9"||n>="a"&&n<="z"||n>="A"&&n<="Z"||V.existsIn(n,[".","!","/","?","(",")","@","#","€","$","%","&","{","}","+","-","*","<",">","|",",",":",";","_","^","~",'"',"£","½","'"]))}function L(n){var e=Y.pop();e(n),0===Y.length&&(nn=[],T())}function N(n,e,o){nn.push(n),Y.push(e),o&&t.set_help(o,nn)}function O(){return V.copy_array(on)}var P,V=VIM_GENERIC,F={getInsertedCharsInLastInsertModeSession:function(){return W},addedInsertModeChar:r,removedInsertModeChar:i,setMark:a,getMark:c,getMode:u,setMode:s,registerCommand:C,registerInsertModeCommand:l,addAction:N,isInsertableCharacter:B,executor:e,setInsertMode:_,setCommandMode:v,isCommandMode:y,isInsertMode:R,getLastCommandChain:O,interpretOneCommand:x,interpretSequence:E,saveToRegister:M,loadFromRegister:g,reset:d,undo:h,startMacroRecording:f,endMacroRecording:m,playMacro:p,isRecordingMacro:function(){return K},setCommandChainChangeIsAllowed:function(n){G=n}},G=!0,W=[],Z={},j={},D=e.copyContent(),H={},J=[],K=!1,Q="command",U="insert",X=Q,Y=[],nn=[],en={},tn={},on=[],rn=[];return $(function(){$(".text").focus(),t.initialize(),o.sendMessage("interpreter_initialized")}),{interpretOneCommand:x,interpretSequence:E,is_insert_mode:R,environment:F}}