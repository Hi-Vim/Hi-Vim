function createTutorial(e,n,t,o){function i(e,n,t,o){return{name:e,paragraphs:t,preFun:n,postFun:o}}function r(e){_.push(e)}function s(e){setTimeout(function(){t.sendMessage(e)},0)}function c(e,o){if(0===e.length)return void s("tutorial_next_section");var i=e[0];e=e.slice(1);var r=void 0!==i.code?i.code:i,u=void 0!==i.postFun?i.postFun:f.nothing,a=o(r);showInfo("Press "+r+" to show command: "+r),t.sendMessage("waiting_for_code",{end:!1,code:r});var _=t.listenTo("pressed_key",function(i){if(a(i))return setTimeout(function(){n.interpretOneCommand(r),u(),c(e,o)},0),t.sendMessage("waiting_for_code",{end:!0,code:r}),t.REMOVE_THIS_LISTENER});t.listenTo("abort_section",function(){return t.removeListener("pressed_key",_),s("tutorial_next_section"),t.REMOVE_THIS_LISTENER})}function u(e){f.for_each_indexed(f.reverse(e),function(n,t){var o=e.length-t-1,i=1+o+".Â "+n.name,r=$("<div />",{class:"section_menu_item",number:o,text:i});$(".section_menu_append_target").prepend(r)})}function a(){u(_),e.show(),runSections(e,n,t,_,o)}var f=VIM_GENERIC,_=[];return{startTutorial:a,registerSection:r,createSection:i,showCommandOneByOne:c}}function allowUserInput(){$(".screen_view").addClass("active_context")}function preventUserInput(){$(".screen_view").removeClass("active_context")}function showInfo(e){$(".info").text(e)}function hideInfo(){$(".info").hide()}function runSections(e,n,t,o,i){function r(){w=!w}function s(e){return 32===T.charToInt(e)?"Space":e}function c(e){I=!!e}function u(e){if(e===M)r();else if("Space"===e)n.environment.setInsertMode(),n.interpretOneCommand(e);else{var t=$(i.getChar(e));w&&t.addClass("emphasized"),t.insertBefore($(".cursor"))}}function a(e,n,t){if(0===e.length||E)t&&t();else{var o=e.substr(1),i=s(e.charAt(0));if(u(i),I)a(o,0,t);else{var r="."===i?S:n;setTimeout(function(){a(o,n,t)},r)}}}function f(e,t,o){function i(e){e.length>0&&n.interpretOneCommand("Enter"),setTimeout(function(){f(e,t,o)},I?0:t)}if(0===e.length||E)o&&o();else{var r=e.pop(),s=T.copy_array(e),c=r;I?a(c,0,function(){i(s)}):a(c,g,function(){i(s)})}}function _(e){E?(c(!1),setTimeout(m,0)):(t.listenTo("tutorial_next_section",function(){return setTimeout(m,0),t.REMOVE_THIS_LISTENER}),c(!1),e.postFun())}function d(){}function m(){if(w=!1,E=!1,n.environment.reset(),preventUserInput(),c(!1),hideInfo(""),d(),t.listenTo("pressed_key",function(){return c(!0),t.REMOVE_THIS_LISTENER}),v=void 0!==v?v+1:0,!(v>=o.length)){p(),h=o[v];var i=T.copy_array(h.paragraphs);$(".title",e).text(h.name),h.preFun(),n.environment.setInsertMode(),f(T.reverse(i),C,function(){_(h)})}}function l(){$(".section_menu_item").on("click",function(){var e=$(this).attr("number");v=e-1,E=!0,setTimeout(function(){t.sendMessage("abort_section")},0)})}function p(){$(".section_menu_item.selected").removeClass("selected"),$(".section_menu_item[number="+v+"]").addClass("selected")}var v,h,I=!1,T=VIM_GENERIC,E=!1,g=20,S=600,C=800,M="|",w=!1;$(".section_menu_item").off(),$(l),m()}